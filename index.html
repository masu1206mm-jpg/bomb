<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ã‚²ãƒ¼ãƒ ï¼çœŸãƒ»ãƒ©ã‚¹ãƒœã‚¹é™è‡¨</title>
  <style>
    :root { --main-red: #ff3300; --soul-orange: #ffaa00; }
    body {
      margin: 0; background: #000; color: #fff;
      font-family: 'Arial Black', sans-serif; overflow: hidden;
      user-select: none; -webkit-touch-callout: none;
    }
    #game-ui {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 10;
    }
    .status-bar {
      position: absolute; top: 10px; left: 10px; right: 10px;
      display: flex; justify-content: space-between; font-size: 18px;
    }
    .soul-gauge-container {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 80%; height: 100px; /* ã‚²ãƒ¼ã‚¸ã‚’å°‘ã—å¤ªã */
      background: rgba(255,255,255,0.2);
      border: 2px solid #fff; border-radius: 10px; overflow: hidden;
    }
    #soul-inner {
      width: 0%; height: 100%; background: linear-gradient(90deg, var(--soul-orange), var(--main-red));
      transition: width 0.1s;
    }
    #boss-alert {
      position: absolute; top: 30%; width: 100%; text-align: center;
      font-size: 40px; color: yellow; font-weight: 900; display: none;
      text-shadow: 5px 5px #ff0000; animation: flash 0.5s infinite;
    }
    @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    canvas { display: block; touch-action: none; background: #1a2a1a; }
    
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 100; text-align: center; padding: 20px;
    }
    .start-btn {
      margin-top: 30px; padding: 20px 50px; font-size: 24px;
      background: var(--main-red); color: #fff; border: none; border-radius: 50px; cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="overlay" id="overlay">
    <h1>ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ã‚²ãƒ¼ãƒ ï¼</h1>
    <p>é­‚ã‚’ç‡ƒã‚„ã›ï¼çœŸã®ç‹ãŒé™è‡¨ã™ã‚‹ğŸ”¥</p>
    <button class="start-btn" id="startBtn">é­‚ã‚’ç‡ƒã‚„ã™ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆï¼‰</button>
  </div>

  <div id="game-ui">
    <div class="status-bar">
      <div>SCORE: <span id="score">0</span></div>
      <div>TIME: <span id="time">30.0</span></div>
    </div>
    <div id="boss-alert">çœŸã®çˆ†ç ´ç‹ã€é™è‡¨ï¼ï¼</div>
    <div class="soul-gauge-container">
      <div id="soul-inner"></div>
      <div style="position:absolute; top:0; width:100%; text-align:center; font-size:12px; line-height:20px;">BOSS SOUL GAUGE</div>
    </div>
  </div>

  <canvas id="cv"></canvas>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const soulInner = document.getElementById('soul-inner');
  const bossAlert = document.getElementById('boss-alert');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('overlay');

  // ç”»åƒã®èª­ã¿è¾¼ã¿ï¼ˆã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã‚‚ã‚²ãƒ¼ãƒ ã¯æ­¢ã‚ãªã„ï¼‰
  const bossImg = new Image();
  bossImg.crossOrigin = "anonymous";
  bossImg.src = 'https://r.jina.ai/i/13677da714314c9c849cc791c140411a'; 

  let width, height, score = 0, timeLeft = 30, running = false;
  let couples = [], particles = [], shake = 0, soul = 0, boss = null;

  function resize() {
    width = cv.width = window.innerWidth;
    height = cv.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function createBoss() {
    bossAlert.style.display = 'block';
    setTimeout(() => { bossAlert.style.display = 'none'; }, 2000);
    return { x: width / 2, y: -300, targetY: height / 3, hp: 40, size: 250, state: 'entry' };
  }

  function drawBoss(ctx, b) {
    ctx.save();
    ctx.translate(b.x, b.y);
    
    // å††å½¢åˆ‡ã‚ŠæŠœã
    ctx.beginPath();
    ctx.arc(0, 0, b.size/2, 0, Math.PI*2);
    ctx.clip();

    if (bossImg.complete && bossImg.naturalWidth > 0) {
      // å†™çœŸã‚’è¡¨ç¤º
      ctx.drawImage(bossImg, -b.size/2, -b.size/2, b.size, b.size);
    } else {
      // èª­ã¿è¾¼ã¿ä¸­/å¤±æ•—æ™‚ã¯ç´«ã®å††
      ctx.fillStyle = '#800080';
      ctx.fillRect(-b.size/2, -b.size/2, b.size, b.size);
    }
    ctx.restore();

    // é‡‘ã®ãƒ•ãƒ¬ãƒ¼ãƒ 
    ctx.strokeStyle = 'gold';
    ctx.lineWidth = 10;
    ctx.strokeRect(b.x - b.size/2, b.y - b.size/2, b.size, b.size); // æ•¢ãˆã¦å››è§’ã„æ ã§å¼·èª¿

    // ãƒœã‚¹HP
    ctx.fillStyle = 'red';
    ctx.fillRect(b.x - 100, b.y - b.size/2 - 30, (b.hp/40)*200, 15);
  }

  function update() {
    if(!running) return;
    timeLeft -= 1/60;
    if(shake > 0) shake *= 0.9;

    if(timeLeft <= 0) {
      running = false;
      alert(`é­‚ã®çˆ†ç ´çµæœï¼š${score}ç‚¹ï¼`);
      location.reload();
      return;
    }

    if(soul >= 100 && !boss) {
      boss = createBoss();
      soul = 99;
    }

    if(boss) {
      if(boss.state === 'entry') {
        boss.y += 5;
        if(boss.y >= boss.targetY) boss.state = 'fight';
      } else {
        boss.x += Math.sin(Date.now()/400) * 5;
      }
    }

    // ã‚«ãƒƒãƒ—ãƒ«å‡ºç¾ï¼ˆãƒœã‚¹ä¸­ã§ã‚‚å‡ºç¾ï¼‰
    if(Math.random() < 0.05 && couples.length < 8) {
      const isLeft = Math.random() > 0.5;
      couples.push({
        x: isLeft ? -50 : width + 50,
        y: height * 0.4 + Math.random() * height * 0.4,
        vx: (isLeft ? 1 : -1) * (2 + Math.random() * 2),
        color: `hsl(${Math.random()*360}, 70%, 70%)`
      });
    }

    couples.forEach((c, i) => {
      c.x += c.vx;
      if(c.x < -100 || c.x > width + 100) couples.splice(i, 1);
    });

    draw();
    requestAnimationFrame(update);
  }

  function draw() {
    ctx.clearRect(0, 0, width, height);
    ctx.save();
    ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
    
    ctx.fillStyle = boss ? '#300' : '#121';
    ctx.fillRect(0, 0, width, height);

    if(boss) drawBoss(ctx, boss);

    couples.forEach(c => {
      ctx.fillStyle = c.color;
      ctx.beginPath(); ctx.arc(c.x-20, c.y, 20, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(c.x+20, c.y, 20, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = 'red'; ctx.fillText('â¤ï¸', c.x-10, c.y-20);
    });

    ctx.restore();
    scoreEl.innerText = score;
    timeEl.innerText = timeLeft.toFixed(1);
    soulInner.style.width = soul + '%';
  }

  cv.addEventListener('pointerdown', e => {
    if(!running) return;
    const { clientX: ex, clientY: ey } = e;
    let hit = false;

    if(boss) {
      const dist = Math.sqrt((ex-boss.x)**2 + (ey-boss.y)**2);
      if(dist < boss.size/2) {
        boss.hp--;
        score += 1000;
        shake = 10;
        hit = true;
        if(boss.hp <= 0) {
          alert("çœŸã®çˆ†ç ´ç‹ã‚’å€’ã—ãŸï¼");
          boss = null; soul = 0; score += 50000;
        }
      }
    }

    couples.forEach((c, i) => {
      if(Math.abs(ex - c.x) < 60 && Math.abs(ey - c.y) < 40) {
        couples.splice(i, 1);
        score += 500;
        soul = Math.min(100, soul + 15);
        shake = 5;
        hit = true;
      }
    });
  });

  startBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    running = true;
    update();
  });
})();
</script>
</body>
</html>
