<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ï¼ã€œçœŸãƒ»ã‚«ã‚ªã‚¹ã‚¢ãƒ—ãƒ‡ã€œ</title>
  <style>
    :root { --main-red: #ff3300; --soul-orange: #ffaa00; }
    body { margin: 0; background: #000; color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; user-select: none; }
    #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    .status-bar { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; font-size: 20px; }
    #damage-flash { position: fixed; inset: 0; background: rgba(255, 0, 0, 0.5); opacity: 0; pointer-events: none; z-index: 5; }
    .soul-gauge-container {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 80%; height: 25px; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 10px; overflow: hidden;
    }
    #soul-inner { width: 0%; height: 100%; background: linear-gradient(90deg, var(--soul-orange), var(--main-red)); transition: width 0.1s; }
    #boss-alert { position: absolute; top: 30%; width: 100%; text-align: center; font-size: 40px; color: yellow; font-weight: 900; display: none; text-shadow: 5px 5px #ff0000; animation: flash 0.5s infinite; }
    @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    canvas { display: block; touch-action: none; background: #000; }
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; padding: 20px; }
    .start-btn { margin-top: 30px; padding: 20px 50px; font-size: 24px; background: var(--main-red); color: #fff; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px var(--main-red); }
  </style>
</head>
<body>

  <div id="damage-flash"></div>
  <div class="overlay" id="overlay">
    <h1>ğŸ’¥ ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ï¼çœŸãƒ»ã‚«ã‚ªã‚¹</h1>
    <p>ã‚¤ãƒãƒ£ã¤ã„ã¦ã‚‹å¥´ã‚‰ã®<span style="color:#ff69b4;">å…‰ç·š</span>ã‚’é®æ–­ã›ã‚ˆï¼<br>æ”¾ç½®ã™ã‚‹ã¨å¯¿å‘½ãŒãƒãƒƒãƒã§æ¸›ã‚‹ãï¼</p>
    <button class="start-btn" id="startBtn">é­‚ã‚’ç‡ƒã‚„ã™ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆï¼‰</button>
  </div>

  <div id="game-ui">
    <div class="status-bar">
      <div>SCORE: <span id="score">0</span></div>
      <div>TIME: <span id="time">30.0</span></div>
    </div>
    <div id="boss-alert">çœŸã®é¡”æ–‡å­—ç‹ğŸ‘‘é™è‡¨ï¼ï¼</div>
    <div class="soul-gauge-container">
      <div id="soul-inner"></div>
    </div>
  </div>

  <canvas id="cv"></canvas>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const soulInner = document.getElementById('soul-inner');
  const bossAlert = document.getElementById('boss-alert');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('overlay');
  const damageFlash = document.getElementById('damage-flash');

  const emojis = ['ğŸ¥¸', 'ğŸ¤¡', 'ğŸ˜¡', 'ğŸ’€', 'ğŸ‘½', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸ¤®', 'ğŸ‘»', 'ğŸƒ', 'ğŸ¥¶', 'ğŸ¤¥'];
  const burstEmojis = ['ğŸ’¥', 'ğŸ”¥', 'âœ¨', 'âš¡ï¸', 'ğŸ’¢'];

  let width, height, score = 0, timeLeft = 30, running = false;
  let couples = [], particles = [], shake = 0, soul = 0, boss = null;

  function resize() {
    width = cv.width = window.innerWidth;
    height = cv.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function createCouple() {
    const isLeft = Math.random() > 0.5;
    return {
      x: isLeft ? -100 : width + 100,
      y: height * 0.2 + Math.random() * height * 0.6,
      vx: (isLeft ? 1.2 : -1.2) * (1.5 + Math.random() * 3),
      e1: emojis[Math.floor(Math.random()*emojis.length)],
      e2: emojis[Math.floor(Math.random()*emojis.length)],
      hue: Math.random() * 360
    };
  }

  function createExplosion(x, y, isBoss = false) {
    shake = isBoss ? 60 : 20;
    const count = isBoss ? 50 : 15;
    for(let i=0; i<count; i++) {
      particles.push({
        x, y,
        vx: (Math.random()-0.5) * (isBoss ? 30 : 15),
        vy: (Math.random()-0.5) * (isBoss ? 30 : 15),
        emoji: burstEmojis[Math.floor(Math.random()*burstEmojis.length)],
        size: Math.random() * 30 + 10,
        life: 1.0,
        rotate: Math.random() * Math.PI * 2
      });
    }
  }

  function update() {
    if(!running) return;
    if(shake > 0) shake *= 0.9;

    // ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡ºã®å¼·åŒ–
    if(couples.length > 0) {
      timeLeft -= couples.length * 0.012; // ãƒ€ãƒ¡ãƒ¼ã‚¸å¢—é‡
      damageFlash.style.opacity = Math.min(0.7, couples.length * 0.15);
    } else {
      damageFlash.style.opacity = 0;
    }
    
    timeLeft -= 1/60;

    if(timeLeft <= 0) {
      running = false;
      alert(`ã€çµ‚ç„‰ã€‘ ã‚¹ã‚³ã‚¢: ${score}\nã‚¤ãƒãƒ£ã‚¤ãƒãƒ£å…‰ç·šã«è€ãˆãã‚Œãªã‹ã£ãŸâ€¦`);
      location.reload();
      return;
    }

    if(soul >= 100 && !boss) {
      bossAlert.style.display = 'block';
      setTimeout(() => { bossAlert.style.display = 'none'; }, 2000);
      boss = { x: width / 2, y: -200, hp: 50, size: 250, state: 'entry' };
      soul = 99;
    }

    if(boss) {
      if(boss.state === 'entry') {
        boss.y += 4;
        if(boss.y >= height/3) boss.state = 'fight';
      } else {
        boss.x += Math.sin(Date.now()/300) * 8;
        boss.y += Math.cos(Date.now()/500) * 4;
      }
    }

    if(Math.random() < 0.08 && couples.length < 15) {
      couples.push(createCouple());
    }
    
    couples.forEach((c, i) => {
      c.x += c.vx;
      if(c.x < -200 || c.x > width + 200) couples.splice(i, 1);
    });

    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.life -= 0.02;
      if(p.life <= 0) particles.splice(i, 1);
    });

    draw();
    requestAnimationFrame(update);
  }

  function draw() {
    ctx.save();
    ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
    
    // èƒŒæ™¯ï¼šãƒœã‚¹æˆ¦ã¯ç¦ã€…ã—ã
    ctx.fillStyle = boss ? (Date.now() % 200 < 100 ? '#400' : '#200') : '#111';
    ctx.fillRect(0, 0, width, height);

    if(boss) {
      ctx.textAlign = 'center';
      ctx.font = `${boss.size}px Arial`;
      ctx.fillText('ğŸ‘‘ğŸ”¥', boss.x, boss.y + 80);
      ctx.fillStyle = 'red';
      ctx.fillRect(boss.x-100, boss.y-120, (boss.hp/50)*200, 15);
    }

    couples.forEach(c => {
      // ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£å…‰ç·šï¼ˆãƒ”ãƒ³ã‚¯ã®ç¨²å¦»ï¼‰
      ctx.strokeStyle = '#ff69b4';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(c.x - 30, c.y);
      ctx.lineTo(c.x + 30, c.y + (Math.random()-0.5)*20);
      ctx.stroke();

      ctx.font = '60px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(c.e1, c.x - 40, c.y);
      ctx.fillText(c.e2, c.x + 40, c.y);
      ctx.font = '40px Arial';
      ctx.fillText('â¤ï¸', c.x, c.y - 40 + Math.sin(Date.now()/200)*10);
      
      // ä¸å¿«ã‚ªãƒ¼ãƒ©
      ctx.fillStyle = `hsla(${c.hue}, 100%, 50%, 0.2)`;
      ctx.beginPath();
      ctx.arc(c.x, c.y, 80, 0, Math.PI*2);
      ctx.fill();
    });

    particles.forEach(p => {
      ctx.save();
      ctx.globalAlpha = p.life;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rotate);
      ctx.font = `${p.size}px Arial`;
      ctx.fillText(p.emoji, 0, 0);
      ctx.restore();
    });
    ctx.restore();

    scoreEl.innerText = Math.floor(score);
    timeEl.innerText = Math.max(0, timeLeft).toFixed(1);
    soulInner.style.width = soul + '%';
  }

  function tap(ex, ey) {
    if(!running) return;
    let hit = false;

    if(boss) {
      const dist = Math.sqrt((ex-boss.x)**2 + (ey-boss.y)**2);
      if(dist < boss.size/1.5) {
        boss.hp--;
        createExplosion(ex, ey, false);
        score += 1500;
        hit = true;
        if(boss.hp <= 0) {
          createExplosion(boss.x, boss.y, true);
          boss = null; score += 50000; soul = 0; timeLeft += 10;
          alert("ã€ç¥ã€‘çœŸã®é¡”æ–‡å­—ç‹ã‚’ç ´å£Šï¼");
        }
      }
    }

    for(let i = couples.length - 1; i >= 0; i--) {
      const c = couples[i];
      if(Math.abs(ex - c.x) < 100 && Math.abs(ey - c.y) < 70) {
        createExplosion(c.x, c.y);
        couples.splice(i, 1);
        score += 500;
        soul = Math.min(100, soul + 10);
        hit = true;
      }
    }
    if(!hit) { shake = 5; score = Math.max(0, score - 50); }
  }

  cv.addEventListener('pointerdown', e => {
    e.preventDefault();
    tap(e.clientX, e.clientY);
  });
  
  startBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    running = true;
    update();
  });
})();
</script>
</body>
</html>
