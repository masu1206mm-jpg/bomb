<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ï¼ã€œå…¨æ–¹ä½ç²›æ¸…ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã€œ</title>
  <style>
    :root { --pink: #ff00ff; --cyan: #00ffff; }
    body { margin: 0; background: #000; color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; user-select: none; }
    #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    .status-bar { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; text-shadow: 2px 2px #000; }
    .soul-gauge-container {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 90%; height: 12px; background: rgba(255,255,255,0.1); border: 1px solid #fff; border-radius: 10px; overflow: hidden;
    }
    #soul-inner { width: 0%; height: 100%; background: linear-gradient(90deg, #00ffff, #ff00ff); transition: width 0.1s; }
    canvas { display: block; touch-action: none; background: #000; }
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; padding: 20px; }
    .start-btn { margin-top: 30px; padding: 25px 80px; font-size: 28px; background: #ff00ff; color: #fff; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 0 40px #ff00ff; }
  </style>
</head>
<body>

  <div class="overlay" id="overlay">
    <h1>ğŸ’¥ ã‚«ãƒƒãƒ—ãƒ«çˆ†ç ´ï¼å…¨æ–¹ä½ç²›æ¸…</h1>
    <p>ç‹ã®æ€’ã‚ŠãŒ360åº¦çˆ†ç™ºã™ã‚‹ï¼<br>æ¥µå¤ªã®<span style="color:#ff00ff; font-size: 1.3em;">ã€Œå…¨æ–¹ä½ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£å…‰ç·šã€</span>ã§<br>ç”»é¢ä¸Šã®ä¸ç´”ç•°æ€§äº¤éŠã‚’æ ¹çµ¶ã›ã‚ˆï¼</p>
    <button class="start-btn" id="startBtn">æ®²æ»…é–‹å§‹</button>
  </div>

  <div id="game-ui">
    <div class="status-bar">
      <div>SCORE: <span id="score">0</span></div>
      <div>TIME: <span id="time">30.0</span></div>
    </div>
    <div class="soul-gauge-container"><div id="soul-inner"></div></div>
  </div>

  <canvas id="cv"></canvas>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const soulInner = document.getElementById('soul-inner');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('overlay');

  const emoji = ['ğŸ‘¨â€â¤ï¸â€ğŸ‘¨', 'ğŸ‘©â€â¤ï¸â€ğŸ‘©', 'ğŸ‘©â€â¤ï¸â€ğŸ‘¨', 'ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨', 'ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨', 'ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©', 'ğŸ’•'];

  let width, height, score = 0, timeLeft = 30, running = false;
  let couples = [], particles = [], texts = [], shake = 0, soul = 0, boss = null;

  function resize() {
    width = cv.width = window.innerWidth;
    height = cv.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function createExplosion(x, y, isBoss = false, txt = "") {
    shake = isBoss ? 150 : 8;
    if(txt) texts.push({ x, y, val: txt, life: 1.0 });
    const count = isBoss ? 200 : 5;
    for(let i=0; i<count; i++) {
      particles.push({
        x, y, vx: (Math.random()-0.5)*25, vy: (Math.random()-0.5)*25,
        life: 1.0, size: Math.random()*8+2, color: isBoss ? '#fff' : '#ff33ff'
      });
    }
  }

  function update() {
    if(!running) return;
    if(shake > 0) shake *= 0.92;
    
    timeLeft -= 1/60;
    if(timeLeft <= 0) {
      running = false;
      alert(`ã€çµ‚ç„‰ã€‘ ã‚¹ã‚³ã‚¢: ` + score.toLocaleString());
      location.reload();
      return;
    }

    if(soul >= 100 && !boss) {
      boss = { x: width/2, y: -250, hp: 150, targetY: height/2, beamTimer: 0, isBeaming: false, charge: 0 };
      soul = 99;
    }

    if(boss) {
      if(boss.y < boss.targetY) boss.y += 10;
      boss.beamTimer++;
      
      if(!boss.isBeaming && boss.beamTimer > 80) {
          boss.charge += 4;
          if(boss.charge >= 100) {
              boss.isBeaming = true;
              boss.beamTimer = 0;
              boss.charge = 0;
              shake = 100;
          }
      }
      if(boss.isBeaming && boss.beamTimer > 50) {
        boss.isBeaming = false;
        boss.beamTimer = 0;
      }
    }

    let spawnRate = boss ? 0.7 : 0.2;
    let maxLimit = boss ? 180 : 40;

    if(couples.length < maxLimit && Math.random() < spawnRate) {
       couples.push({
         x: Math.random() * width,
         y: Math.random() * height,
         vx: (Math.random()-0.5) * 10,
         vy: (Math.random()-0.5) * 10,
         char: emoji[Math.floor(Math.random()*emoji.length)]
       });
    }
    
    couples.forEach((c, i) => {
      c.x += c.vx; c.y += c.vy;
      if(c.x < -100 || c.x > width + 100 || c.y < -100 || c.y > height + 100) {
          couples.splice(i, 1);
          return;
      }

      if(boss && boss.isBeaming) {
        const beamCount = 16; 
        for(let j=0; j < beamCount; j++) {
            const angle = (j * Math.PI * 2) / beamCount;
            const dx = c.x - boss.x;
            const dy = c.y - boss.y;
            const dist = Math.abs(dx * Math.sin(angle) - dy * Math.cos(angle));
            if(dist < 60) {
                createExplosion(c.x, c.y, false);
                couples.splice(i, 1);
                score += 1500;
                break;
            }
        }
      }
    });

    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.life -= 0.05;
      if(p.life <= 0) particles.splice(i, 1);
    });

    texts.forEach((t, i) => {
      t.y -= 4; t.life -= 0.04;
      if(t.life <= 0) texts.splice(i, 1);
    });

    draw();
    requestAnimationFrame(update);
  }

  function draw() {
    ctx.save();
    ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
    ctx.fillStyle = boss && boss.isBeaming && boss.beamTimer % 2 === 0 ? '#404' : '#000';
    ctx.fillRect(0, 0, width, height);

    if(boss) {
      if(boss.isBeaming) {
        ctx.save();
        ctx.translate(boss.x, boss.y);
        const beamCount = 16;
        for(let j=0; j < beamCount; j++) {
            ctx.save();
            ctx.rotate((j * Math.PI * 2) / beamCount);
            const grad = ctx.createLinearGradient(0, -50, 0, 50);
            grad.addColorStop(0, "transparent");
            grad.addColorStop(0.5, boss.beamTimer % 4 < 2 ? "white" : "#ff00ff");
            grad.addColorStop(1, "transparent");
            ctx.fillStyle = grad;
            ctx.fillRect(0, -50, width * 2, 100);
            ctx.restore();
        }
        ctx.restore();
      }
      ctx.font = '110px Arial'; ctx.textAlign = 'center';
      ctx.fillText('ğŸ¤´', boss.x - 70, boss.y + 30);
      ctx.fillText('ğŸ‘¸', boss.x + 70, boss.y + 30);
      if(boss.charge > 0) {
          ctx.strokeStyle = '#00ffff';
          ctx.lineWidth = 5;
          ctx.beginPath();
          ctx.arc(boss.x, boss.y, boss.charge * 2, 0, Math.PI*2);
          ctx.stroke();
      }
    }

    couples.forEach(c => {
      ctx.font = '50px Arial'; ctx.textAlign = 'center';
      ctx.fillText(c.char, c.x, c.y);
    });

    particles.forEach(p => {
      ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
    });

    texts.forEach(t => {
      ctx.globalAlpha = t.life; ctx.fillStyle = "#fff";
      ctx.font = 'bold 35px sans-serif'; ctx.fillText(t.val, t.x, t.y);
    });

    ctx.restore();
    scoreEl.innerText = Math.floor(score).toLocaleString();
    timeEl.innerText = Math.max(0, timeLeft).toFixed(1);
    soulInner.style.width = soul + '%';
  }

  function tap(ex, ey) {
    if(!running) return;
    if(boss) {
      const d = Math.sqrt((ex-boss.x)**2 + (ey-boss.y)**2);
      if(d < 180) {
        boss.hp--; createExplosion(ex, ey, false, "âœ¨");
        score += 10000;
        if(boss.hp <= 0) {
          createExplosion(boss.x, boss.y, true, "G A M E  C L E A R");
          boss = null; score += 2000000; soul = 0; timeLeft = Math.min(30, timeLeft + 20);
        }
        return;
      }
    }
    for(let i = couples.length - 1; i >= 0; i--) {
      const c = couples[i];
      if(Math.abs(ex - c.x) < 60 && Math.abs(ey - c.y) < 60) {
        createExplosion(c.x, c.y, false);
        couples.splice(i, 1); score += 5000; soul = Math.min(100, soul + 10);
        break;
      }
    }
  }

  cv.addEventListener('pointerdown', e => { e.preventDefault(); tap(e.clientX, e.clientY); });
  startBtn.addEventListener('click', () => { overlay.style.display = 'none'; running = true; update(); });
})();
</script>
</body>
</html>
