<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>„Ç´„ÉÉ„Éó„É´ÁàÜÁ†¥„Ç≤„Éº„É†ÔºÅÈ≠Ç„ÅÆËß£ÊîæÔºà„É©„Çπ„Éú„ÇπÈôçËá®Ôºâ</title>
  <style>
    :root { --main-red: #ff3300; --soul-orange: #ffaa00; --boss-purple: #800080; }
    body {
      margin: 0; background: #000; color: #fff;
      font-family: 'Arial Black', sans-serif; overflow: hidden;
      user-select: none; -webkit-touch-callout: none;
    }
    #game-ui {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 10;
    }
    .status-bar {
      position: absolute; top: 10px; left: 10px; right: 10px;
      display: flex; justify-content: space-between; font-size: 18px;
    }
    .soul-gauge-container {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 80%; height: 20px; background: rgba(255,255,255,0.2);
      border: 2px solid #fff; border-radius: 10px; overflow: hidden;
    }
    #soul-inner {
      width: 0%; height: 100%; background: linear-gradient(90deg, var(--soul-orange), var(--main-red));
      transition: width 0.1s;
    }
    #combo-text {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 60px; color: var(--main-red); font-weight: 900;
      opacity: 0; pointer-events: none; text-shadow: 0 0 20px #fff;
    }
    #boss-alert {
      position: absolute; top: 30%; width: 100%; text-align: center;
      font-size: 50px; color: yellow; font-weight: 900; display: none;
      text-shadow: 5px 5px #ff0000; animation: flash 0.5s infinite;
    }
    @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    canvas { display: block; touch-action: none; background: #1a2a1a; }
    
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 100; text-align: center; padding: 20px;
    }
    .title-area h1 { font-size: 42px; margin: 0; color: var(--main-red); text-shadow: 4px 4px #fff; }
    .start-btn {
      margin-top: 30px; padding: 20px 50px; font-size: 24px;
      background: var(--main-red); color: #fff; border: none; border-radius: 50px; cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="overlay" id="overlay">
    <div class="title-area">
      <h1>„Ç´„ÉÉ„Éó„É´ÁàÜÁ†¥„Ç≤„Éº„É†ÔºÅ</h1>
      <p>È≠Ç„ÇíÁáÉ„ÇÑ„Åó„Å¶„É©„Çπ„Éú„Çπ„ÇíÂºï„Åç„Åö„ÇäÂá∫„Åõüî•</p>
    </div>
    <button class="start-btn" id="startBtn">„Ç≤„Éº„É†„Çπ„Çø„Éº„Éà</button>
  </div>

  <div id="game-ui">
    <div class="status-bar">
      <div>SCORE: <span id="score">0</span></div>
      <div>TIME: <span id="time">30.0</span></div>
    </div>
    <div id="combo-text">COMBO!!</div>
    <div id="boss-alert">WARNING: BOSS APPROACHING!!</div>
    <div class="soul-gauge-container">
      <div id="soul-inner"></div>
    </div>
  </div>

  <canvas id="cv"></canvas>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const soulInner = document.getElementById('soul-inner');
  const comboEl = document.getElementById('combo-text');
  const bossAlert = document.getElementById('boss-alert');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('overlay');

  let width, height, score = 0, timeLeft = 30, running = false;
  let couples = [], particles = [], shake = 0, combo = 0, soul = 0;
  let boss = null;

  function resize() {
    width = cv.width = window.innerWidth;
    height = cv.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function createCouple() {
    const isLeft = Math.random() > 0.5;
    return {
      x: isLeft ? -100 : width + 100,
      y: height * 0.4 + Math.random() * height * 0.4,
      vx: (isLeft ? 1 : -1) * (2 + Math.random() * 3),
      p1: { face: Math.random(), color: `hsl(${Math.random()*360}, 60%, 70%)` },
      p2: { face: Math.random(), color: `hsl(${Math.random()*360}, 60%, 70%)` },
      dead: false
    };
  }

  function createBoss() {
    bossAlert.style.display = 'block';
    setTimeout(() => { bossAlert.style.display = 'none'; }, 2000);
    return {
      x: width / 2,
      y: -300,
      targetY: height / 2 - 100,
      hp: 20,
      size: 250,
      speed: 2,
      state: 'entry' // entry, fight, dead
    };
  }

  function createExplosion(x, y, isBoss = false) {
    shake = isBoss ? 30 : 15;
    const count = isBoss ? 100 : 40;
    for(let i=0; i<count; i++) {
      particles.push({
        x, y,
        vx: (Math.random()-0.5) * (isBoss ? 40 : 20),
        vy: (Math.random()-0.5) * (isBoss ? 40 : 20),
        r: Math.random() * (isBoss ? 30 : 15) + 5,
        life: 1.0,
        color: isBoss ? '#ff00ff' : (Math.random() > 0.5 ? '#ff4400' : '#ffaa00')
      });
    }
  }

  function drawBoss(ctx, b) {
    ctx.save();
    ctx.translate(b.x, b.y);
    
    // „É©„Çπ„Éú„ÇπÁâπÊúâ„ÅÆ„ÄåÂàá„ÇäÂèñ„ÇäÈ°î„ÄçÈ¢®ÊèèÁîª
    // ÂΩ±
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.beginPath(); ctx.arc(10, 10, b.size/2, 0, Math.PI*2); ctx.fill();

    // È°î„ÅÆËº™ÈÉ≠
    ctx.fillStyle = '#fce2c4';
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 5;
    ctx.beginPath(); ctx.arc(0, 0, b.size/2, 0, Math.PI*2); ctx.fill(); ctx.stroke();

    // ÊÄ™„Åó„ÅÑÁõÆ
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.ellipse(-50, -30, 40, 25, 0.2, 0, Math.PI*2); ctx.fill(); ctx.stroke();
    ctx.beginPath(); ctx.ellipse(50, -30, 40, 25, -0.2, 0, Math.PI*2); ctx.fill(); ctx.stroke();
    
    ctx.fillStyle = '#000';
    ctx.beginPath(); ctx.arc(-45 + Math.sin(Date.now()/200)*5, -30, 10, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(55 + Math.sin(Date.now()/200)*5, -30, 10, 0, Math.PI*2); ctx.fill();

    // „Å∏„ÅÆÂ≠ó„ÅÆÂè£
    ctx.beginPath();
    ctx.moveTo(-60, 60);
    ctx.quadraticCurveTo(0, 30, 60, 60);
    ctx.stroke();

    // BOSS„ÅÆÊñáÂ≠ó
    ctx.fillStyle = 'red';
    ctx.font = 'bold 40px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('THE REALITY', 0, -b.size/2 - 20);

    ctx.restore();
  }

  function update() {
    if(!running) return;
    if(shake > 0) shake *= 0.9;
    timeLeft -= 1/60;

    if(timeLeft <= 0) {
      running = false;
      alert(`„Çø„Ç§„É†„Ç¢„ÉÉ„ÉóÔºÅ„Çπ„Ç≥„Ç¢: ${score}`);
      location.reload();
    }

    // È≠Ç„ÅåÊ∫ú„Åæ„Å£„Åü„Çâ„Éú„ÇπÂá∫Áèæ
    if(soul >= 100 && !boss) {
      boss = createBoss();
      soul = 99; // Âá∫ÁèæÁõ¥Âæå„ÅØ„É™„Çª„ÉÉ„Éà
    }

    // „Éú„ÇπÊõ¥Êñ∞
    if(boss) {
      if(boss.state === 'entry') {
        boss.y += boss.speed;
        if(boss.y >= boss.targetY) boss.state = 'fight';
      } else if(boss.state === 'fight') {
        boss.x += Math.sin(Date.now()/500) * 5;
      }
    } else {
      // „Ç´„ÉÉ„Éó„É´Êõ¥Êñ∞Ôºà„Éú„ÇπÊà¶‰∏≠„ÅØÂá∫„Å™„ÅÑÔºâ
      if(Math.random() < 0.03 && couples.length < 5) couples.push(createCouple());
    }
    
    couples.forEach((c, i) => {
      c.x += c.vx;
      if(c.x < -200 || c.x > width + 200) couples.splice(i, 1);
    });

    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy; p.life -= 0.02;
      if(p.life <= 0) particles.splice(i, 1);
    });

    draw();
    requestAnimationFrame(update);
  }

  function draw() {
    ctx.save();
    const sx = (Math.random()-0.5) * shake;
    const sy = (Math.random()-0.5) * shake;
    ctx.translate(sx, sy);

    ctx.fillStyle = boss ? '#2d002d' : '#1a2a1a'; // „Éú„ÇπÊà¶„ÅØËÉåÊôØËâ≤Â§âÂåñ
    ctx.fillRect(-100, -100, width+200, height+200);
    ctx.fillStyle = '#333';
    ctx.fillRect(0, height*0.4, width, height*0.5);

    if(boss) drawBoss(ctx, boss);

    couples.forEach(c => {
      drawPerson(ctx, c.x, c.y, c.p1, false);
      drawPerson(ctx, c.x, c.y, c.p2, true);
      ctx.fillStyle = '#ff0000'; ctx.font = '20px Arial'; ctx.fillText('‚ù§Ô∏è', c.x-10, c.y-30);
    });

    particles.forEach(p => {
      ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
    });
    ctx.restore();

    scoreEl.innerText = score;
    timeEl.innerText = timeLeft.toFixed(1);
    soulInner.style.width = soul + '%';
  }

  function drawPerson(ctx, x, y, p, isRight) {
    const offset = isRight ? 25 : -25;
    ctx.fillStyle = p.color;
    ctx.beginPath(); ctx.ellipse(x + offset, y + 40, 20, 30, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#ffdbac';
    ctx.beginPath(); ctx.arc(x + offset, y, 20, 0, Math.PI*2); ctx.fill();
  }

  function tap(ex, ey) {
    if(!running) return;
    let hit = false;

    // „Éú„ÇπÂà§ÂÆö
    if(boss && boss.state !== 'dead') {
      const dist = Math.sqrt((ex-boss.x)**2 + (ey-boss.y)**2);
      if(dist < boss.size/2) {
        boss.hp--;
        createExplosion(ex, ey, false);
        score += 500;
        hit = true;
        if(boss.hp <= 0) {
          createExplosion(boss.x, boss.y, true);
          boss = null;
          score += 10000;
          soul = 0;
          alert("CONGRATULATIONS! „É©„Çπ„Éú„ÇπÁàÜÁ†¥ÊàêÂäüÔºÅ");
        }
      }
    }

    // „Ç´„ÉÉ„Éó„É´Âà§ÂÆö
    couples.forEach((c, i) => {
      if(Math.abs(ex - c.x) < 80 && Math.abs(ey - c.y) < 60) {
        createExplosion(c.x, c.y);
        couples.splice(i, 1);
        score += 100 + (combo * 20);
        combo++;
        soul = Math.min(100, soul + 15);
        hit = true;
        showCombo();
      }
    });

    if(!hit) { combo = 0; soul = Math.max(0, soul - 10); }
  }

  function showCombo() {
    if(combo < 2) return;
    comboEl.innerText = `${combo} COMBO!!`;
    comboEl.style.opacity = 1;
    setTimeout(() => comboEl.style.opacity = 0, 500);
  }

  cv.addEventListener('pointerdown', e => tap(e.clientX, e.clientY));
  startBtn.addEventListener('click', () => { overlay.style.display = 'none'; running = true; update(); });
})();
</script>
</body>
</html>
